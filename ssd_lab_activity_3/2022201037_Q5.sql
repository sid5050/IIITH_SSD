SELECT DISTINCT MGR_DATA.Mgr_ssn,MGR_DATA.Dnumber AS DEPT_ID,COUNT(*) FROM DEPENDENT JOIN (SELECT DISTINCT DEPARTMENT.Mgr_ssn,DEPARTMENT.Dnumber FROM DEPARTMENT JOIN (SELECT DEPT_LOCATIONS.Dnumber, COUNT(DEPT_LOCATIONS.Dlocation) AS LOCATIONS FROM DEPT_LOCATIONS GROUP BY DEPT_LOCATIONS.Dnumber HAVING LOCATIONS >= 2) AS DEPT_DATA WHERE DEPT_DATA.Dnumber=DEPARTMENT.Dnumber) AS MGR_DATA WHERE DEPENDENT.Essn=MGR_DATA.Mgr_ssn GROUP BY MGR_DATA.Mgr_ssn,MGR_DATA.Dnumber;
